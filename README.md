# Automatic plates recognition
Система для автоматического распознавания российских номерных знаков

## Getting started

Requirements

* Python >= 3.7
* RAM >= 32GB
* GPU >= 8GB
* CUDA >= 10.0

Посмотреть пример работы системы:

````
$ python inference.py
````
Видео по [ссылке](https://drive.google.com/drive/folders/13ioOz5enOzW-IXUqd1GcuxtqtTpWBNrh?usp=sharing).

## Датасет
Для работы был выбран открытый набор данных с kaggle VKCV_2022_Contest_02: Carplates Recognition, содержащий 
автомобильные номера (государственные регистрационные знаки). На одном изображении может быть 1 или более номерных 
знаков. Файл с описанием ГРЗ для каждого изображения обучающей выборки – train.json, имеет вид:

````
{"file": rel_path", "nums": [[[x1, y1], [x2, y2], [x3, y3],[ x4, y4]], [...]}
````
В обучающей выборке 26806 картинок (jpg: 17929, bmp: 7704), в тестовой – 3157 (jpg: 2225, bmp: 833, jpeg: 51, png: 41, 
JPG: 6, webp: 1).

Данные можно загрузить по [ссылке](https://disk.yandex.ru/d/NANSgQklgRElog).

## Модели
Для детекции номерных знаков использовались модели yolo v4 и yolo v5, которые дообучались на наших данных.
Для обучения yolo v4 использовался фреймворк darknet.

Характеристики машины, на которой проводилось обучение: Intel Core i5-10400, NVIDIA GeForce RTX 2070, 32 Gb RAM.

Скачать обученные модели можно по [ссылке](https://drive.google.com/drive/folders/1BzMX_qxbXGL1pJ9BkzZgPccJaQEp57OT?usp=sharing).

Обучение yolo v4:

[img](https://github.com/Demin132132/dl_1_26_car_license_plate_recognition/blob/test_/dl_1_26_car_license_plate_recognition/raw/test_/img/img.jpg)

Результаты обучеения представлены в таблице.

| Модель  | Число эпох обучения | Время обучения | avg_loss | Batch |            parametrs            |
|:-------:|:-------------------:|:--------------:|:--------:|:-----:|:-------------------------------:|
| yolo v4 |        9000         |      22 ч      |   0.17   |  16   | lr:0.01; Adam; momentum: 0.949  | 
| yolo v5 |        1300         |      5 ч       |   0.07   |  16   | lr:0.01; Adam; momentum: 0.937  |

yolo v5 намного быстрее вышла на плато, в примере работы системы используется именно она.

## OCR 
Для распознавания символов на изображении использовался Tesseract OCR, для оценки качества использовались метрики 
Character error rate (CER) и Word Error Rate (WER). В таблице представлены результаты для инференсных изображений.

| Метрика | 1.jpg  | 2.jpg  | 3.jpg  | 
|:-------:|:------:|:------:|:------:|
|   CER   | 36.36  | 25.0   | 27.27  | 
|   WER   | 100.0  | 100.0  | 100.0  | 

Для улучшения качества распознавания была предпринята попытка дообучения Tesseract OCR на собственных данных.
Для этого были собраны и размечены (посимвольно) изображения номерных знаков. Для разметки использовался jTessBoxEditor.
Из полученного .tif файла с помощью Serak Trainer For Tesseract был сгенерирован файл ````rus.traineddata````, который 
нужно поместить в каталог к языковым моделям ````/usr/local/share/tessdata/````. 

В таблице представлены результаты для инференсных изображений.

| Метрика | 1.jpg  | 2.jpg  | 3.jpg  | 
|:-------:|:------:|:------:|:------:|
|   CER   | 8.33   | 0.0    |  0.0   | 
|   WER   | 100.0  | 0.0    |  0.0   | 
